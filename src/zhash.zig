pub const Hash = u64;

const piece_table = [12 * 128]Hash{
    // White Pawn
    0x772D191994666910, 0x3B968C8D5E553488, 0x1DCB4646AF4C9A44, 0x0EE8BA3AC3A62422, 0x87794D1CF5B51211, 0xF49CA68FEEBC8918, 0xCD634347F738448C, 0x5191A1A3FB9C2246, 0, 0, 0, 0, 0, 0, 0, 0,
    0x28C8D9C869CE7823, 0x946975FDA0E75501, 0x7D14B3E6D073C390, 0x3E8A50EAFC5F88C8, 0x1F4528757E49C464, 0x0FAF843B2B24E232, 0x87D7C21C01921819, 0xF4CBE10F94AF651C, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCD45F99E5E31B28E, 0xD182F5D72F7EB047, 0x5FEC6AEA03BF3133, 0xAFFB257501DFF189, 0x60DD9BA280EF91D4, 0xB063D4C8D411C8EA, 0xEF11EA646A08E475, 0xC0A5E53235621B2A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x577FE2988ED76495, 0x2BB2E14DD36BDB5A, 0x95D979BF7DD384AD, 0xFDCCB5C7BE8FAB46, 0xC9C653FA4B47BCA3, 0xD3C329FCB1A3B741, 0xDEC19DE658D1DBB0, 0x5840CEF32C0E84D8, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2C2D7E619661426C, 0x9616B6295F56C836, 0x7C264B14AFCD641B, 0x3E13258BC3E6DB1D, 0x1F099BDC75956D9E, 0x0F84CDEFAEACB6CF, 0x87C266F7D7305B77, 0x74C13A63EB982DAB, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3A6D8D31F5AA7FC5, 0x9D3BDF80FAD53FF2, 0xF9B0F6D9E96AF6F9, 0x4BF56B6D60B57B6C, 0xA5F7A5B6B05AD4B6, 0xE5DBDBC3582D6A5B, 0x45CDEDE1AC70B53D, 0xA2EBE6F0D65E338E, 0, 0, 0, 0, 0, 0, 0, 0,
    0xE655FA606B2F70C7, 0xC40AF429A197D173, 0xD5286A14D0CB81A9, 0x5DB9250BFC03A9C4, 0xAEDC9B9C6A01D4E2, 0xE04E4DCFA100EA71, 0xC70726E7D0807528, 0xD4AE8373E8403A94, 0, 0, 0, 0, 0, 0, 0, 0,
    0x5D7A58A1F446744A, 0xAEB035496E453A25, 0x60750AA4B7449D02, 0x30379C4BCFC44E81, 0x181BCE25E7842750, 0x8C0DE712F3C27AA8, 0xF12BE388ED875454, 0xCFB8E1C476A5AA2A, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Pawn
    0x2199F2D60EC51D2C, 0x90CCF07307048E96, 0x7F46712183822E4B, 0x3FAE2890C1C11735, 0x9FD71D5060E08B8A, 0xF8CB8EA9A4162CC5, 0xCB45C754D20B7F72, 0x5282E3ABFD63D6B9, 0, 0, 0, 0, 0, 0, 0, 0,
    0x294178CC6AB1EB4C, 0x14ADAC66353E9CA6, 0x0A56DF2A8EF94E53, 0x0526768CD37CA739, 0x0293325FFDD8538C, 0x81499037FE8A40C6, 0x7784C81A6B452063, 0xBBC2640CA1A2F921, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6AC13B1FC4B71580, 0xB56D8D8E763D8AC0, 0x6D96C6C73B1EAC60, 0x36CB63639DE95630, 0x9B68A1B1CE92C218, 0xFA9459C0E72F080C, 0xCA6735F9E7F18406, 0x521393E4F3F8C203, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2909C9F279FC6111, 0x1484E4F8A8FE5998, 0x0A427B6454192CCC, 0x852C2DB22A0C9666, 0x75BB06D881062233, 0xBADD836DD4E51109, 0xEA4EC1B6EA72E194, 0x420760DAE13970CA, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2103B975709CB865, 0x1081D5A2B84E3522, 0x0840EAD15C411A91, 0x042D65693A208D58, 0x8216BBAD091046AC, 0xF6264DD684EE4A56, 0x4C3E3FF342774C2B, 0x261F16E1A13BCF05, 0, 0, 0, 0, 0, 0, 0, 0,
    0x930F8B70D09DE792, 0x7EAADCA0684E9AC9, 0xBF556E5034414D74, 0x688ABE301A20A6BA, 0xB44556000D763A5D, 0x6D02AB0006DD1D3E, 0xB6815C9997088E9F, 0xEC6DB754CB84475F, 0, 0, 0, 0, 0, 0, 0, 0,
    0x4116D2B265A423BF, 0x208B6958A6B411CF, 0x1045BDB4535A61F7, 0x882FCEDBBDCB59EB, 0x733AFE75DE83C5E5, 0x399D7622EF278BE2, 0x9CCEB208E393ACF1, 0x7947501DE5AFBF68, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3CAEB116F2D7B6B4, 0x1E575193796BB25A, 0x0F26B1D1BCD3B02D, 0x879351F0DE0FB106, 0x74E4B1E06F61D883, 0x3A7F48F037D68551, 0x9D32BD601BEB2BB8, 0x79B44EB00D93FCDC, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Knight
    0x50F160E23B52BC15, 0x2875A0711DCF371A, 0x9437C0391AE7F28D, 0xFD36F9048D15F956, 0xC9B66C8246ECFCAB, 0xD3F6264123761745, 0x5EDB1A3905DD0BB2, 0xAF60940482EEECD9, 0, 0, 0, 0, 0, 0, 0, 0,
    0x60904A0241771F7C, 0xB048250120BBE6BE, 0xEF041B99043B9A5F, 0xC0AF14D4821DCD3F, 0xD77A9372410E8F8F, 0xDC9D49B8B4E147D7, 0xD963BDC45A70A3FB, 0xDB91D7FBB93851ED, 0, 0, 0, 0, 0, 0, 0, 0,
    0xDAE5F2E5DCFA41E6, 0xDA52F06B7A7D20F3, 0x5A09712C293EF969, 0x2D04B18F809F15A4, 0x168251DE54298AD2, 0x0B4128EEBE72AC69, 0x05AD84775F5F3F24, 0x82D6C23A3BAFF692, 0, 0, 0, 0, 0, 0, 0, 0,
    0xF64B611C89D79249, 0xCC05B996448DC934, 0x512FCCCAB620E49A, 0x2897E6655B10724D, 0x944BFA2B39883936, 0x7D05F40C08C41C9B, 0x3E82F31F9062675D, 0x9F417097C83133BE, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7880B153E47EF0DF, 0x3C4051B1F23F117F, 0x1E2D31C0F91FE1AF, 0x0F1691F9E88F99C7, 0x878B48FD6047A5F3, 0x74E8BD66B023BBE9, 0xBA794EB35811DDE4, 0x6A1CA7583808EEF2, 0, 0, 0, 0, 0, 0, 0, 0,
    0x350E5AB41C621E79, 0x1A872D5B9A310F2C, 0x8D439FB5CD7EEE96, 0x7181CFDB72BF1E4B, 0xB8C0E7EC2D398F35, 0x6B407AEF829CC78A, 0xB5AD2D77C14E0AC5, 0x6DFB86BA74C10572, 0, 0, 0, 0, 0, 0, 0, 0,
    0x36F0DA453A6082B9, 0x1B75743B0930414C, 0x0DB7AA1C109820A6, 0x86DBDC16084C1053, 0x744DEE0A90266139, 0x3A2BE7054813598C, 0x1D15FA9B3009ACC6, 0x0E8AF4559804D663, 0, 0, 0, 0, 0, 0, 0, 0,
    0x87457332CC646B21, 0x7482B08166543580, 0x3A415159274C1AC0, 0x9D2DB1B493A66460, 0x79BBC8DBDDB53230, 0xBCDDE46C7ADAF018, 0x694EFB2FA96D780C, 0x34AA6D97D4D0BC06, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Knight
    0x06458B2DA1F1C829, 0x832FDC8F449E8D04, 0xF6BAF75E36294682, 0xCC706BAE8F72CA41, 0xD1183CCED3B96530, 0xDFA10E6769DCB298, 0x58FD9E2A20EE304C, 0xAC73D60C84111826, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6119EB0642088C13, 0x308CFC9AB5622F19, 0x984677555AB1179C, 0xFB0332B2AD3EE2CE, 0xCAAC8958C29F1867, 0x527B5DB4614FE523, 0x2930B7C230A79B81, 0x949852F88C35CDD0, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7D613064467CE6E8, 0xBEBD8832233E1A74, 0x6873DD01119F643A, 0xB434F7991CA9B21D, 0xED376BCD1A54D91E, 0x41B6A5E68D4C6C8F, 0x20DB5BEAD2A65F57, 0x1060B4ECFD352FBB, 0, 0, 0, 0, 0, 0, 0, 0,
    0x883D4A767EFC97CD, 0xF333BC233F184BF6, 0xCEB4CE119FEA4CFB, 0x50777E10CF934F6D, 0x2836AF09F3C9A7A6, 0x141B5E9D6D82BAD3, 0x0A0DAF4F22C15D79, 0x8506DEBE0506C7AC, 0, 0, 0, 0, 0, 0, 0, 0,
    0x75AE764702830AD6, 0xBAD7323A1527EC6B, 0x6A4B90050A939F25, 0x3528D11B1149CF82, 0x1A94688C1CC28EC1, 0x8D4A3D5F9A614770, 0x718517B7CD56CAB8, 0x38C28BDA72AB0C5C, 0, 0, 0, 0, 0, 0, 0, 0,
    0x9C6C5CF53955862E, 0xF9162E7B08AAAA17, 0xCBA6073C1055551B, 0x52FE1A86082AC39D, 0xA972145A901561DE, 0xE3990A2CDC6CB0EF, 0x46E19C0FFA363167, 0x237DD71E691B71A3, 0, 0, 0, 0, 0, 0, 0, 0,
    0x91B3F29734EBD1C1, 0xFFF4E94A0E1381F0, 0xC8DA7DBC9309C0F8, 0x534D37C64984E07C, 0xA9AB8BE324A4703E, 0xE3F8DCE80634381F, 0x46DC6E74031A751F, 0xA363273B95EB539F, 0, 0, 0, 0, 0, 0, 0, 0,
    0xE6919A85CAF5A9DF, 0xC465D45B717ABDFF, 0x5512EA2C2CDB37EF, 0x2A897C0F826D9BE7, 0x1544B71E5550CDE3, 0x0AAF4B8EBECE0FE1, 0x0557A5C75F0107E0, 0x82A6C2E3AFE6EAF0, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Bishop
    0x1A553FD3EA685E03, 0x8D278FE861342F11, 0x71BEDEEDA4FC1798, 0xB8DF6F76D27E62CC, 0x6B4FBEA3693F5866, 0x35AACF51B4F9AC33, 0x9AD567A94E1ABF09, 0x7A4ABACD330D5F94, 0, 0, 0, 0, 0, 0, 0, 0,
    0xBD284D669986C6CA, 0x69B93FAAD8C30A65, 0x34DC96CCF8618522, 0x9A63527FE830C291, 0x7A11A93E60186158, 0xBD08DD87300C30AC, 0xE9A977DA0C601856, 0xC3F9ABEC92300C2B, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD6DCDCEFDD7E6F05, 0xDC4E6E77EED93792, 0xD9073E23F70AF2C9, 0xDBAE8F11FB857974, 0x5AFA5E90FDA4BCBA, 0xAD7036507EB45E5D, 0x619812303F3C2F3E, 0x30CC09198B9E7E9F, 0, 0, 0, 0, 0, 0, 0, 0,
    0x186B1D94C5A93F5F, 0x0C3897D262D49FBF, 0x861C4BE8A50C4FCF, 0xF4233CEDC6E027F7, 0xCD3C8E76E37013EB, 0xD1B35E2371B809E5, 0xDFF4B6082CBA6DE2, 0xD8DA521D825D36F1, 0, 0, 0, 0, 0, 0, 0, 0,
    0xDB4D290F55489B68, 0x5A869D9E3EC224B4, 0xAD434ECE8B61125A, 0xE181A76745D6E02D, 0x47EDC3B3A2EB1906, 0x23FBF8C1D1758C83, 0x91F0EC60E8BAAF51, 0x7FD87F29E05D57B8, 0, 0, 0, 0, 0, 0, 0, 0,
    0xBFE12F94F02EC2DC, 0x68D09ED27817086E, 0xB46556713C6D8437, 0x6D12AB390A36AB0B, 0x36895C84857D5595, 0x1B44AE4242BEC3DA, 0x0DAF4721215F08ED, 0x06D7A39090AFED66, 0, 0, 0, 0, 0, 0, 0, 0,
    0x0366C1C9DC31F6B3, 0x81BE79FD7A18FB49, 0xF7F22CFF290C7DB4, 0x4CD91F6794E03EDA, 0xA66196AA5E16766D, 0x6410CB552F6D3B26, 0xB20865AB03B6F493, 0x6E2922D581DB1359, 0, 0, 0, 0, 0, 0, 0, 0,
    0x37149872C0ED89BC, 0x9B8A4C38F410C4DE, 0xFAE83F047A08626F, 0xCA54169BA9043127, 0xD20A0B4C40827183, 0xDE281CBFB42751D1, 0xD8391747DA13C1F8, 0x5B3192BA7909E0FC, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Bishop
    0x4CE1D41C70CB2A3F, 0x267DF3163865950F, 0x1333E98A8832A397, 0x8999FDDCD01951DB, 0x73E1EEEFFC6AC1FD, 0x39FDE777FE5309EE, 0x9CF3E3BA6B2984F7, 0x7959F8C535F2AB6B, 0, 0, 0, 0, 0, 0, 0, 0,
    0xBCA1EC629AF955A5, 0xE97DE6314D1AC3C2, 0x439EFA00A6EB08E1, 0xA1CF7419C713ED60, 0x67C7B314E389F6B0, 0x33EEC98BE5A29258, 0x19FA7DDC66B7202C, 0x8CF02EEFA73D9016, 0, 0, 0, 0, 0, 0, 0, 0,
    0x71581E6E47F8C80B, 0xB8A1162EB79A0D15, 0xEB7D920ECFAB6F9A, 0x429EC90767B3DECD, 0xA14F6483B3D9EF76, 0xE787BB584D8A9EBB, 0x44EECDADB2C54F4D, 0xA27A7FCF4D04A7B6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x661D36FE32823ADB, 0x330E926719411D7D, 0x198749338CC6E7AE, 0x8CC3A49852631AD7, 0x7141DB5429318D7B, 0xB8ADF4B214FEAFAD, 0xEB7BEA589E1957C6, 0xC29DFC344F6AC2E3, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD663EE1BB3B56161, 0xDC11FE15D9DAD9A0, 0xD925EF0B78ED6CD0, 0xDBBFE785BC10B668, 0xDAF2E3C2DE6E3234, 0xDA5978F8FB37701A, 0x5A0CB5647DFDB80D, 0x2D0653ABAAFEB516, 0, 0, 0, 0, 0, 0, 0, 0,
    0x168329D5D5195A8B, 0x8B419DF2EA8CAD55, 0xF280CEF8E1463FBA, 0x4E6D7E6470A376DD, 0x273BAF323851BB7E, 0x939DDE811C4EB4BF, 0xFEE3F6591A27334F, 0x4851F2348D7599B7, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA425E91BD2BAA5CB, 0x653FE48C7D3B3BF5, 0x329FFB5FAA9D9DEA, 0x994FF4B7D528CEF5, 0x7B87F343EA94676A, 0xBDC3F0B8614A5AB5, 0xE9C1F14430A52D4A, 0xC3C0F1BB8C3496A5, 0, 0, 0, 0, 0, 0, 0, 0,
    0x56C071C5C67C4B42, 0x2B6D28E2E33E4CA1, 0x95BB8471719F4F40, 0x7DF0DB20B8CFCEA0, 0xBEF57489C8678E50, 0x685AB35D7033AE28, 0xB42049AF2C7FBE14, 0xED3D3DCE023FB60A, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Rook
    0xAD98C95CA884F07E, 0xE1E17DB65424783F, 0x47D0B7C32A12550F, 0x23E54BE1956F4397, 0x11FFBCE95ED1A1DB, 0x88F2CE74AF0EB9FD, 0x7359673BC38735EE, 0xB9A1A39C75A59AF7, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6BFDC1CFAEB4CD6B, 0xB5F3F9FE435A0FA5, 0x6DD9F5E721AD07C2, 0x36E1EAF390D6EAE1, 0x9B7DE5785C0D7560, 0xFA9EFBA42E60BAB0, 0x4A626DD217563458, 0x253C26E89FCD1A2C, 0, 0, 0, 0, 0, 0, 0, 0,
    0x129E1A6DDBE6E416, 0x094F0D36ED95720B, 0x04AA9F8376ACB915, 0x82554FC1BB56359A, 0xF60AA7E0DDCD1ACD, 0x4C2843F06E808D76, 0x261421F9A34046BB, 0x130A19E4D1A0234D, 0, 0, 0, 0, 0, 0, 0, 0,
    0x09850CF268D011B6, 0x84C28678A06808DB, 0xF541433DC4526D7D, 0x4D80A19F764F5FAE, 0x26C059D7BB27C6D7, 0x936D35F3DDF5E37B, 0xFE9693E1EE9CF1AD, 0x486650E9634E11C6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x243E316D25C108E3, 0x121F11AF0686ED61, 0x090F88D783431FA0, 0x0487C46A55C7E6D0, 0x8243E2352AE39A68, 0x7601F8029517A434, 0xBB00F518DEEDD21A, 0x6AAD6A8DFB76800D, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3556BC5F69BB2916, 0x1AA64E2E20DD948B, 0x0D532717106EA355, 0x86A4838A1C5151BA, 0x747F58DC9A28A8DD, 0xBA32B5764D723D7E, 0xEA344ABAB2B91EBF, 0xC2373C45595C8F4F, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD6368E22ACC847B7, 0xDC365E08C26423CB, 0x5936361DF55411F5, 0x2C9B1216FAAA61EA, 0x164D890AE95530F5, 0x8B2BDD9CE0AAF16A, 0x72B8F7D6705578B5, 0x395C72F3382AD54A, 0, 0, 0, 0, 0, 0, 0, 0,
    0x1CA3297808156AA5, 0x0E519DA4046CB542, 0x0725D7CB96505AA1, 0x0392EBE5CB282D40, 0x01C97CEB719416A0, 0x80E9AE75B8CA6250, 0x7754DE22DC035828, 0x3BA77608FA01AC14, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Rook
    0xFB2C229332278442, 0x4ABB01480D75C221, 0x255D80A406DCE100, 0x12A3D94B97087080, 0x0951ECA5CB843840, 0x84A5E652E5A41C20, 0x757FE328E6B40E10, 0xBAB2E194735A6E08, 0, 0, 0, 0, 0, 0, 0, 0,
    0x6A7460CBADCB5E04, 0x35372065D683C602, 0x1A9B992B7F278A01, 0x0D4DCC95BFF5C510, 0x86ABFF52DF9CE288, 0x7478EFA8FBCE1844, 0xBA3167D47D810C22, 0x6A35A3EBAAC08611, 0, 0, 0, 0, 0, 0, 0, 0,
    0xB51AD8EC41604318, 0x6DA0756FB4D6488C, 0x36D033AE4E0D2446, 0x1B6509D727609223, 0x0DBF9DF393B04901, 0x06DFCEF85DBE4D90, 0x0362FE642EB926C8, 0x81BC6F32173AFA64, 0, 0, 0, 0, 0, 0, 0, 0,
    0x77F327989FFB1432, 0xBBF483CDDBFD8A19, 0x6ADA41E6ED98C51C, 0x356039EAE2CC628E, 0x9ABD0CF571665847, 0xFA739F62B8B34533, 0xCA19CFB15C3FCB89, 0x5221FEC0AE79E5D4, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2910F679C33CF2EA, 0x94887224E19E1075, 0x7D69291270CF612A, 0x3EB98488AC01B095, 0x1F5CC2445666B15A, 0x8FA3783BBF5558AD, 0x70FCAC1C4BAAC546, 0x3873460FB1D562A3, 0, 0, 0, 0, 0, 0, 0, 0,
    0x9C34BA1E4C8CB141, 0xF9374D0EB24631B0, 0x4BB6BF9ECD4518D8, 0xA5DB56D766C48C6C, 0x65CDAB6A27044636, 0x32EBC5B513824A1B, 0x1978FBC289C1251D, 0x8CB16DE14486FB9E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7175A6F0A24314CF, 0x38B7C379C547E377, 0x9C5BE1BD76C5F1AB, 0xF90DF9C6BB6291C5, 0xCBABECE35DD721F2, 0x52F8E671AE8D90F9, 0x297163394346A16C, 0x94B5A19D35C550B6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7D77C0CF0E84A85B, 0xBEB6F97E13423D3D, 0x68766CBE9DC7778E, 0xB436265EDAE3D2C7, 0x6D36032EF971E973, 0x369B01977CDE9DA9, 0x1B4D80CA2A6F27C4, 0x8DABD97C8137FAE2, 0, 0, 0, 0, 0, 0, 0, 0,
    // White Queen
    0x9DD3B21DE900D60A, 0xF9C9D016F4E60205, 0x4BC4E80AEE150112, 0x25EF6405776C8089, 0x12FAA202BBB62954, 0x897041015DBD14AA, 0x73982080AEB88A55, 0xB9CC1959C35C453A, 0, 0, 0, 0, 0, 0, 0, 0,
    0xEBC60CAD75C8229D, 0x42C30656BAE4115E, 0xA16C9A335D1408AF, 0xE7964D183A8A6D47, 0x44E63F941D235FB3, 0x227E0FCB9A91AFC9, 0x91321EFC5948D7F4, 0x7FB416662CC202FA, 0, 0, 0, 0, 0, 0, 0, 0,
    0x3FDA0B331607687D, 0x1FE01C818B03DD2E, 0x0FFD17595181EE97, 0x87F392B4A8C0F75B, 0x74D9C95BC0607BBD, 0xBA61FDB5E0303DCE, 0xEA10F7C2F0181EE7, 0xC2256BE1780C0F63, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD63FA5F0BC6007A1, 0xDC32C2F9CA3003C0, 0x59347864E57E68E0, 0xAC9A352BE6D93470, 0x61600A95F36C9A38, 0xB0BD1C52F9B6241C, 0xEF7397317CBD120E, 0x4099CB992A5EE007, 0, 0, 0, 0, 0, 0, 0, 0,
    0x204CE5CD012F1913, 0x902B62E68097E599, 0xFF38A173404B9BDC, 0xC8B140B83443A4EE, 0xD375B9441A21D277, 0xDE9AD5BB9910E92B, 0xD86073C5CCEE1D85, 0x5B1030FB727767D2, 0, 0, 0, 0, 0, 0, 0, 0,
    0xAD881165B93BDAE9, 0xE1E911AB489DED64, 0xC7D488D5A428F6B2, 0xD4CA446B46721259, 0xDD452235A339093C, 0xD9829802D19C849E, 0xDBEC5518FCA8424F, 0xDAD62A8DEA542137, 0, 0, 0, 0, 0, 0, 0, 0,
    0xDA4B1C5F612A798B, 0xDA058E2E24F355D5, 0x5A2FDE0E861FC3FA, 0xAD17EF07430F88FD, 0x61A6E783A187AD6E, 0x30D37AD844A5D6B7, 0x9864AD6DB634EB4B, 0xFB125FAF4F7C75B5, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCAA436CE33BE53CA, 0x527F0B6719DF40E5, 0x29329CAA18EFC962, 0x94994E550C11E4B1, 0xFD61BE32866E9B48, 0xC990D601433724A4, 0xD3E5721935FD9252, 0x5ED2B0149AFEA029, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black Queen
    0xCB6759D273A3A236, 0x5293ACE8ADB7B81B, 0x2949DF6DC2DBB51D, 0x14A9F6AF750BB39E, 0x0A54F24E2EE3B0CF, 0x852769271717B177, 0x75BEA4938B8BB1AB, 0xBADF5B51C5A3B1C5, 0, 0, 0, 0, 0, 0, 0, 0,
    0xEA4FADA976B7B1F2, 0xC207DFCD2F3DD8F9, 0xD62EF6FF039E856C, 0xDC3A6B7E15A942B6, 0x593025BE9EB2C85B, 0xAC981BC74F3F0D3D, 0x616114FA339FEF8E, 0x30BD936519CF9EC7, 0, 0, 0, 0, 0, 0, 0, 0,
    0x985EC9B28C81CF73, 0x7B0F64D8D240E7A9, 0x3D87BB74692073C4, 0x1EC3D4A234F650E2, 0x8F6CF3488E1D2871, 0xF09670BDD30EFD28, 0xCF66285F7DE17E94, 0x50931D37BE96D64A, 0, 0, 0, 0, 0, 0, 0, 0,
    0xA8498E9A4B4B0225, 0xE304C74CB1A58102, 0xC6AF7ABFCCB4C081, 0xD47AAD5E725A0950, 0xDD1D5FB7392D04A8, 0xD9A3B6C39CF08254, 0xDBFCCB61CE1E282A, 0x5ADE65B0E7691415, 0, 0, 0, 0, 0, 0, 0, 0,
    0x2D6222D9E7D2E31A, 0x16BC016D678F188D, 0x8B5E00B6B3C7E556, 0xF28F005ACD85F2AB, 0x4E6A993566A4F945, 0x27385582B35215B2, 0x139C2AC159A90AD9, 0x09CE1C7938D4857C, 0, 0, 0, 0, 0, 0, 0, 0,
    0x04EA17249C0C42BE, 0x0278128BDA06485F, 0x8131105C79034D3F, 0xF7B591363CE7CF8F, 0xCCF7D1831E15E7D7, 0x515BE8C18F6CF3FB, 0x28A0E460C7D079ED, 0x94507B29F78E55E6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x7D08348D6FA12AF3, 0x3E84135F23D09569, 0x9F4209AE058E23A4, 0x788104D702C778D2, 0xBC40826A1505BC69, 0xE90041350A82B724, 0xC3AD398285273292, 0x56FB8CC14293F049, 0, 0, 0, 0, 0, 0, 0, 0,
    0xAB70DF79352F9134, 0xE2986FBD0EF1C89A, 0x466127DF1378E44D, 0x233D83EE1DDA1B36, 0x919EC1F70E8B649B, 0x7FE279E38723DB5D, 0xBFFC2CF1C391EDBE, 0xE8DE1F60E1C8F6DF, 0, 0, 0, 0, 0, 0, 0, 0,
    // White King
    0xAF64480BD97F3904, 0x60922405ECD99C82, 0xB0491B1B626CCE41, 0xEF048D8C25506730, 0xC0AF5FDF86CE5A98, 0x577AB6F7C367444C, 0xABB04B7A75D5A226, 0x62F53CA53AEAB813, 0, 0, 0, 0, 0, 0, 0, 0,
    0x31778E529D133519, 0x18B6DE314EEFF39C, 0x0C5B6F19337790CE, 0x0620A78D0DDDC867, 0x83105ADF12EE8D23, 0x76A5347789772F81, 0xBB529323C4DD97D0, 0xEA894991E26EA2E8, 0, 0, 0, 0, 0, 0, 0, 0,
    0x4269BDD0F1373874, 0x2139CEE9ECFD9C3A, 0x109CE774F618CE1D, 0x884E7AA27B0C671E, 0xF3073448A9865A8F, 0x4EAE8A2454A52D57, 0xA75745122A52FFBB, 0xE48BA28881297FCD, 0, 0, 0, 0, 0, 0, 0, 0,
    0xC568C1444094BFF6, 0xD59460A2204A36FB, 0x5DE7205110251B6D, 0xAEFE80291C748DA6, 0x605F40148E5C46D3, 0x3022B91247482379, 0x1811559123A411AC, 0x0C08AAC905B408D6, 0, 0, 0, 0, 0, 0, 0, 0,
    0x86045C7D16BC046B, 0xF42F37268B5E6B25, 0xCD3A8B9345C93582, 0x51B05CD1A2E49AC1, 0xA8D82E6945144D70, 0xE34C1E2D36EC26B8, 0x46860F169B767A5C, 0x2343078AD9BB542E, 0, 0, 0, 0, 0, 0, 0, 0,
    0x91AC9ADCF8DDAA17, 0x7FFB54767C08D51B, 0xBFF0B3233E62039D, 0x68D850880B3101DE, 0x3461315D919880EF, 0x1A3D88AF5CAA2967, 0x8D1EC457AE337DA3, 0xF1A27B33D77FD7C1, 0, 0, 0, 0, 0, 0, 0, 0,
    0xCFFC2D987FD9EBF0, 0xD0DE1FD43F8A9CF8, 0x5F4F0FEB8BC54E7C, 0xAFAA9EEC51E2CE3E, 0xE0F8566FBC970E1F, 0xC75C2B37DE2D871F, 0xD48E1C83EF70C39F, 0xDD6A175863B861DF, 0, 0, 0, 0, 0, 0, 0, 0,
    0xD9950BADA5BA59FF, 0x5BE79CCF46BB45EF, 0x2DFED77E373BCBE7, 0x96F272A71B9DE5E3, 0x7C59304A19CE9BE1, 0xBE2188250C814DE0, 0xE83DDD0B1240A6F0, 0xC333F79C1D463A78, 0, 0, 0, 0, 0, 0, 0, 0,
    // Black King
    0xF9D0A3C443DC4D38, 0xCBC858FBB588269C, 0xD2C42C7C4EA27A4E, 0xDE421F2627375427, 0xD8010F93139BC303, 0x5B2D9ED189CDE191, 0xAD96CF6950E699D8, 0x61E67EAD3C154CEC, 0, 0, 0, 0, 0, 0, 0, 0,
    0x30FE2F569E6CA676, 0x987207AADB363A3B, 0x7B1903D56DFD1D0D, 0x3D8C81EB22FEE796, 0x9EC640F5917F1ACB, 0xF843207B5CD98D75, 0x4B019925AE0AAFAA, 0xA580CC92D7633ED5, 0, 0, 0, 0, 0, 0, 0, 0,
    0xE5ED7F516BB19F7A, 0x45D6B6B0B5BEA6BD, 0x22E64B59CEB9534E, 0x117E3CB4E73AC0A7, 0x08B20E5BE7FB0943, 0x0459072C679BEDB1, 0x82219A8FA7AB9FC8, 0x763DD45E47B3A6E4, 0, 0, 0, 0, 0, 0, 0, 0,
    0xBB1EEA2EB7BFBA72, 0xEAA265175BDFB439, 0xC27C228A39EFB30C, 0xD61E185C88F7B086, 0xDC221536441DD843, 0x593C1383220E8531, 0x2C9E09C191072B88, 0x164F04E0C883FCC4, 0, 0, 0, 0, 0, 0, 0, 0,
    0x8B2A9B69F041FE62, 0x72B854AD6C469631, 0xB95C2A56B6454B08, 0x6B8E1C335B22CC84, 0x35C70E1839916642, 0x1AEE9E141CAEDA21, 0x8D7A56120E316D00, 0x719D2B089318B680, 0, 0, 0, 0, 0, 0, 0, 0,
    0x38CE9C9DDDEA3240, 0x9C6A5756EE937020, 0xF9152BAAE349B810, 0x4BA785D571A4DC08, 0x25D3C2EB2CB46E04, 0x92E4F86C025A5E02, 0x7E52752F954B4601, 0xBF242A97CAA5A310, 0, 0, 0, 0, 0, 0, 0, 0,
    0x68BF054A7152B888, 0x345F82A538A95C44, 0x9A22D84B0854AE22, 0x7A3C753C102A3E11, 0x3D1E338608151F18, 0x1E8F10DA900AE68C, 0x8F47886CDC631A46, 0x7083C4366E57E423, 0, 0, 0, 0, 0, 0, 0, 0,
    0xB841E21AA32B9B01, 0xEB00F8155195CD90, 0x42AD6C0B3CACE6C8, 0x2156BF1C0A561A64, 0x10A64F8F912B6432, 0x085327C7C895B219, 0x842483E3E42CD91C, 0x753F58E866706C8E, 0, 0, 0, 0, 0, 0, 0, 0,
};

const enpassant_table = [16]Hash{
    0x6C2B47BBA99B427B, 0x3615A3DC40CDA12D, 0x1B0AD8F62066B986, 0x0D856C7A84555CC3, 0x06C2BF25422AC771, 0x036C4F92A11563A8, 0x01BB3ED1508AD8D4, 0x00DD9670A8456C6A, 0, 0, 0, 0, 0, 0, 0, 0,
};

const base_castle_table = [4]Hash{
    0x0063D2205444B635,
    0x003CF009BE445B0A,
    0x001E711D4B224485,
    0x000F3196A5F74B52,
};

pub const move: Hash = 0x000791D352FBCCA9;

const castle_table = blk: {
    var ct: [0b1_000_000]Hash = undefined;
    for (&ct, 0..) |*h, i| {
        h.* = 0;
        if (i & 0b110_000 == 0b110_000) h.* ^= base_castle_table[0];
        if (i & 0b011_000 == 0b011_000) h.* ^= base_castle_table[1];
        if (i & 0b000_110 == 0b000_110) h.* ^= base_castle_table[2];
        if (i & 0b000_011 == 0b000_011) h.* ^= base_castle_table[3];
    }
    break :blk ct;
};

pub fn enpassant(where: u8) Hash {
    return enpassant_table[where & 0xF];
}

pub fn piece(color: Color, ptype: PieceType, where: u8) Hash {
    const index = @as(usize, @intFromEnum(ptype) - 1) << 8 | @as(usize, @intFromEnum(color)) << 7 | @as(usize, where);
    assert(piece_table[index] != 0);
    return piece_table[index];
}

fn castleIndex(c: u64) usize {
    const x = (c & castle_mask.any) *% 0x25;
    const lower = (x >> 5) & 0x07;
    const upper = (x >> 58) & 0x38;
    return upper | lower;
}

pub fn castle(c: u64) Hash {
    return castle_table[castleIndex(c)];
}

test castleIndex {
    try std.testing.expectEqual(0, castleIndex(0));
    try std.testing.expectEqual(0b000_110, castleIndex(castle_mask.wk));
    try std.testing.expectEqual(0b000_011, castleIndex(castle_mask.wq));
    try std.testing.expectEqual(0b110_000, castleIndex(castle_mask.bk));
    try std.testing.expectEqual(0b011_000, castleIndex(castle_mask.bq));
}

const std = @import("std");
const assert = std.debug.assert;
const castle_mask = @import("castle_mask.zig");
const Color = @import("common.zig").Color;
const PieceType = @import("common.zig").PieceType;
